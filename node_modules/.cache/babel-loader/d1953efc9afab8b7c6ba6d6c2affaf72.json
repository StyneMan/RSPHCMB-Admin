{"ast":null,"code":"import _asyncToGenerator from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/regenerator/index.js\";import{Box,Button,Typography}from\"@mui/material\";import React from\"react\";import{ValidatorForm,TextValidator}from\"react-material-ui-form-validator\";import{useHistory}from\"react-router-dom\";import InputAdornment from\"@mui/material/InputAdornment\";import IconButton from\"@mui/material/IconButton\";import Visibility from\"@mui/icons-material/Visibility\";import VisibilityOff from\"@mui/icons-material/VisibilityOff\";import CircularProgress from\"@mui/material/CircularProgress\";import{RefreshOutlined}from\"@mui/icons-material\";import{useDispatch}from\"react-redux\";import{setMyData,setUserData}from\"../../data/redux/slice/user\";import{db,doc,setPersistence,browserSessionPersistence,auth,onSnapshot}from\"../../data/firebase\";import{signInUser}from\"../../domain/service\";import image from\"../../assets/images/logo.svg\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LoginForm=function LoginForm(){var history=useHistory();var _React$useState=React.useState({email:\"\",password:\"\"}),_React$useState2=_slicedToArray(_React$useState,2),formValues=_React$useState2[0],setFormValues=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),showCode=_React$useState4[0],setShowCode=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isLoading=_React$useState6[0],setIsLoading=_React$useState6[1];var dispatch=useDispatch();var handleChange=function handleChange(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;setFormValues(function(prevData){return _objectSpread(_objectSpread({},prevData),{},_defineProperty({},name,value));});};var submitForm=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsLoading(true);setPersistence(auth,browserSessionPersistence).then(function(re){signInUser(formValues.email,formValues.password).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(resp){var _resp$user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://Now get user data\nonSnapshot(doc(db,\"users\",\"\"+(resp===null||resp===void 0?void 0:(_resp$user=resp.user)===null||_resp$user===void 0?void 0:_resp$user.uid)),function(doc){// console.log(\"Current data: \", doc.data());\n// console.log(\"Current User ID: \", resp?.user?.uid);\n// dispatch(setUserID(resp?.user?.uid));\ndispatch(setMyData(doc.data()));dispatch(setUserData(doc.data()));history.push(\"/dashboard\");});case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(err){console.log(\"LOGIN ERR: \",err);});//\n}).catch(function(error){// console.log(\"LOGIN CODE: \", error?.code);\n});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function submitForm(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Box,{paddingTop:5,paddingBottom:8,paddingX:4,display:\"flex\",flexDirection:\"column\",justifyContent:\"start\",children:[/*#__PURE__*/_jsx(Box,{display:\"flex\",flexDirection:\"column\",justifyContent:\"center\",alignItems:\"center\",pb:1,children:/*#__PURE__*/_jsx(\"img\",{src:image,alt:\"\",width:\"60%\"})}),/*#__PURE__*/_jsx(Typography,{gutterBottom:true,fontSize:18,fontWeight:\"600\",paddingBottom:4,textAlign:\"center\",children:\"Sign into your account\"}),/*#__PURE__*/_jsxs(ValidatorForm,{onSubmit:submitForm,children:[/*#__PURE__*/_jsx(TextValidator,{margin:\"normal\",required:true,fullWidth:true,id:\"email\",name:\"email\",value:formValues.email,onChange:handleChange,autoComplete:\"email\",label:\"Email\",placeholder:\"Email\",variant:\"outlined\",validators:[\"required\"],errorMessages:[\"Email address is required\"]}),/*#__PURE__*/_jsx(TextValidator,{margin:\"normal\",required:true,fullWidth:true,name:\"password\",label:\"Password\",type:showCode?\"text\":\"password\",id:\"password\",onChange:handleChange,value:formValues.password,autoComplete:\"current-password\",placeholder:\"Password\",variant:\"outlined\",validators:[\"required\"],errorMessages:[\"Password is required\"],InputProps:{endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"toggle code\",onClick:function onClick(){return setShowCode(!showCode);},onMouseDown:function onMouseDown(){return setShowCode(!showCode);},edge:\"end\",children:showCode?/*#__PURE__*/_jsx(Visibility,{}):/*#__PURE__*/_jsx(VisibilityOff,{})})})}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(Box,{width:\"100%\",display:\"flex\",flexDirection:\"row\",justifyContent:\"space-between\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Button,{variant:\"text\",sx:{textTransform:\"none\"},onClick:function onClick(){return history.push(\"/forgot-password\");},children:\"Forgot password?\"}),/*#__PURE__*/_jsxs(Button,{disabled:isLoading,disableElevation:true,sx:{textTransform:\"none\"},endIcon:isLoading&&/*#__PURE__*/_jsx(CircularProgress,{children:/*#__PURE__*/_jsx(RefreshOutlined,{})}),type:\"submit\",variant:\"contained\",children:[\" \",\"Sign in\"]})]})]})]})});};export default LoginForm;","map":{"version":3,"sources":["/Users/macintosh/Developer/RSPHCMB-Admin/src/presentation/forms/login.js"],"names":["Box","Button","Typography","React","ValidatorForm","TextValidator","useHistory","InputAdornment","IconButton","Visibility","VisibilityOff","CircularProgress","RefreshOutlined","useDispatch","setMyData","setUserData","db","doc","setPersistence","browserSessionPersistence","auth","onSnapshot","signInUser","image","LoginForm","history","useState","email","password","formValues","setFormValues","showCode","setShowCode","isLoading","setIsLoading","dispatch","handleChange","e","target","name","value","prevData","submitForm","then","re","resp","user","uid","data","push","catch","err","console","log","error","endAdornment","textTransform"],"mappings":"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","sourcesContent":["import { Box, Button, Typography } from \"@mui/material\";\nimport React from \"react\";\nimport { ValidatorForm, TextValidator } from \"react-material-ui-form-validator\";\nimport { useHistory } from \"react-router-dom\";\nimport InputAdornment from \"@mui/material/InputAdornment\";\nimport IconButton from \"@mui/material/IconButton\";\nimport Visibility from \"@mui/icons-material/Visibility\";\nimport VisibilityOff from \"@mui/icons-material/VisibilityOff\";\n\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { RefreshOutlined } from \"@mui/icons-material\";\n\nimport { useDispatch } from \"react-redux\";\nimport { setMyData, setUserData } from \"../../data/redux/slice/user\";\nimport {\n  db,\n  doc,\n  setPersistence,\n  browserSessionPersistence,\n  auth,\n  onSnapshot,\n} from \"../../data/firebase\";\nimport { signInUser } from \"../../domain/service\";\nimport image from \"../../assets/images/logo.svg\";\n\nconst LoginForm = () => {\n  const history = useHistory();\n  const [formValues, setFormValues] = React.useState({\n    email: \"\",\n    password: \"\",\n  });\n  const [showCode, setShowCode] = React.useState(false);\n  const [isLoading, setIsLoading] = React.useState(false);\n\n  const dispatch = useDispatch();\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    setFormValues((prevData) => ({ ...prevData, [name]: value }));\n  };\n\n  const submitForm = async (e) => {\n    setIsLoading(true);\n    setPersistence(auth, browserSessionPersistence)\n      .then((re) => {\n        signInUser(formValues.email, formValues.password)\n          .then(async (resp) => {\n            //Now get user data\n            onSnapshot(doc(db, \"users\", \"\" + resp?.user?.uid), (doc) => {\n              // console.log(\"Current data: \", doc.data());\n              // console.log(\"Current User ID: \", resp?.user?.uid);\n              // dispatch(setUserID(resp?.user?.uid));\n              dispatch(setMyData(doc.data()));\n              dispatch(setUserData(doc.data()));\n              history.push(\"/dashboard\");\n            });\n          })\n          .catch((err) => {\n            console.log(\"LOGIN ERR: \", err);\n          });\n        //\n      })\n      .catch((error) => {\n        // console.log(\"LOGIN CODE: \", error?.code);\n      });\n  };\n\n  return (\n    <div>\n      <Box\n        paddingTop={5}\n        paddingBottom={8}\n        paddingX={4}\n        display=\"flex\"\n        flexDirection=\"column\"\n        justifyContent={\"start\"}\n      >\n        <Box\n          display=\"flex\"\n          flexDirection=\"column\"\n          justifyContent={\"center\"}\n          alignItems=\"center\"\n          pb={1}\n        >\n          <img src={image} alt=\"\" width={\"60%\"} />\n        </Box>\n        <Typography\n          gutterBottom\n          fontSize={18}\n          fontWeight=\"600\"\n          paddingBottom={4}\n          textAlign=\"center\"\n        >\n          Sign into your account\n        </Typography>\n        <ValidatorForm onSubmit={submitForm}>\n          <TextValidator\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"email\"\n            name=\"email\"\n            value={formValues.email}\n            onChange={handleChange}\n            autoComplete=\"email\"\n            label=\"Email\"\n            placeholder=\"Email\"\n            variant=\"outlined\"\n            validators={[\"required\"]}\n            errorMessages={[\"Email address is required\"]}\n          />\n\n          <TextValidator\n            margin=\"normal\"\n            required\n            fullWidth\n            name=\"password\"\n            label=\"Password\"\n            type={showCode ? \"text\" : \"password\"}\n            id=\"password\"\n            onChange={handleChange}\n            value={formValues.password}\n            autoComplete=\"current-password\"\n            placeholder=\"Password\"\n            variant=\"outlined\"\n            validators={[\"required\"]}\n            errorMessages={[\"Password is required\"]}\n            InputProps={{\n              endAdornment: (\n                <InputAdornment position=\"end\">\n                  <IconButton\n                    aria-label=\"toggle code\"\n                    onClick={() => setShowCode(!showCode)}\n                    onMouseDown={() => setShowCode(!showCode)}\n                    edge=\"end\"\n                  >\n                    {showCode ? <Visibility /> : <VisibilityOff />}\n                  </IconButton>\n                </InputAdornment>\n              ),\n            }}\n          />\n          <br />\n          <br />\n\n          <Box\n            width={\"100%\"}\n            display=\"flex\"\n            flexDirection={\"row\"}\n            justifyContent=\"space-between\"\n            alignItems={\"center\"}\n          >\n            <Button\n              variant=\"text\"\n              sx={{ textTransform: \"none\" }}\n              onClick={() => history.push(\"/forgot-password\")}\n            >\n              Forgot password?\n            </Button>\n            <Button\n              disabled={isLoading}\n              disableElevation={true}\n              sx={{ textTransform: \"none\" }}\n              endIcon={\n                isLoading && (\n                  <CircularProgress>\n                    <RefreshOutlined />\n                  </CircularProgress>\n                )\n              }\n              type=\"submit\"\n              variant=\"contained\"\n            >\n              {\" \"}\n              Sign in\n            </Button>\n          </Box>\n        </ValidatorForm>\n      </Box>\n    </div>\n  );\n};\n\nexport default LoginForm;\n"]},"metadata":{},"sourceType":"module"}