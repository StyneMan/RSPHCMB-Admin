{"ast":null,"code":"import _asyncToGenerator from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _slicedToArray from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/macintosh/Developer/RSPHCMB-Admin/node_modules/@babel/runtime/regenerator/index.js\";import React from\"react\";import{ValidatorForm,TextValidator}from\"react-material-ui-form-validator\";import Avatar from\"@mui/material/Avatar\";import{makeStyles}from\"@mui/styles\";import Button from\"@mui/material/Button\";import{db,ref,storage,doc,uploadBytesResumable,getDownloadURL,deleteObject,updateDoc}from\"../../../data/firebase\";import{useSnackbar}from\"notistack\";import Backdrop from\"@mui/material/Backdrop\";import{Box}from\"@mui/system\";import{CircularProgress}from\"@mui/material\";import{Typography}from\"@mui/material\";import{Grid}from\"@mui/material\";import RichText from\"../../components/misc/richtext/\";import EditableRichText from\"../../components/misc/richtext/editable\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{image:{margin:\"0px auto 15px auto\",width:128,height:100},mb:{marginBottom:10}};});var CircularProgressWithLabel=function CircularProgressWithLabel(props){return/*#__PURE__*/_jsxs(Box,{position:\"relative\",display:\"inline-flex\",children:[/*#__PURE__*/_jsx(CircularProgress,_objectSpread(_objectSpread({variant:\"determinate\"},props),{},{size:90,thickness:3.0,style:{color:\"green\"}})),/*#__PURE__*/_jsx(Box,{top:0,left:0,bottom:0,right:0,position:\"absolute\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",children:/*#__PURE__*/_jsx(Typography,{variant:\"body1\",component:\"div\",style:{color:\"white\",fontFamily:\"roboto\"},children:\"\".concat(Math.round(props.value),\"%\")})})]});};var UpdateTeamForm=function UpdateTeamForm(props){var classes=useStyles();var setOpen=props.setOpen,id=props.id,name=props.name,position=props.position,biography=props.biography,image=props.image;var _React$useState=React.useState({name:name,image:\"\",position:position}),_React$useState2=_slicedToArray(_React$useState,2),formValues=_React$useState2[0],setFormValues=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),file=_React$useState4[0],setFile=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isUploading=_React$useState6[0],setIsUploading=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isLoading=_React$useState8[0],setIsLoading=_React$useState8[1];var _React$useState9=React.useState(0),_React$useState10=_slicedToArray(_React$useState9,2),progress=_React$useState10[0],setProgress=_React$useState10[1];var _React$useState11=React.useState(biography),_React$useState12=_slicedToArray(_React$useState11,2),bio=_React$useState12[0],setBio=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isError=_React$useState14[0],setIsError=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isStartedFilling=_React$useState16[0],setIsStartedFilling=_React$useState16[1];var _React$useState17=React.useState(\"\"),_React$useState18=_slicedToArray(_React$useState17,2),previewImage=_React$useState18[0],setPreviewImage=_React$useState18[1];var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var handleChange=function handleChange(e){var _e$target=e.target,id=_e$target.id,name=_e$target.name,value=_e$target.value;if(id===\"image\"){setFile(e.target.files[0]);setPreviewImage(URL.createObjectURL(e.target.files[0]));setFormValues(function(prevData){return _objectSpread(_objectSpread({},prevData),{},{image:e.target.value});});}else{setFormValues(function(prevData){return _objectSpread(_objectSpread({},prevData),{},_defineProperty({},name,value));});}};var uploadNewImage=function uploadNewImage(){setIsUploading(true);var timeNow=new Date();//First upload image to firebase storage then save to firestore\nvar storageRef=ref(storage,\"team-members/\"+timeNow.getTime());var uploadTask=uploadBytesResumable(storageRef,file);uploadTask.on(\"state_changed\",function(snapshot){var uprogress=snapshot.bytesTransferred/snapshot.totalBytes*100;setProgress(uprogress);},function(error){setIsUploading(false);// console.log(error);\nenqueueSnackbar(\"\".concat(error===null||error===void 0?void 0:error.message),{variant:\"error\"});},function(){setIsUploading(false);setIsLoading(true);getDownloadURL(uploadTask.snapshot.ref).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(downloadURL){var mRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:mRef=doc(db,\"team-members\",\"\"+id);_context.prev=1;_context.next=4;return updateDoc(mRef,{name:formValues.name,position:formValues.position,biography:bio,updatedAt:timeNow,image:downloadURL});case 4:setOpen(false);setIsLoading(false);enqueueSnackbar(\"Team member updated successfully\",{variant:\"success\"});_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);setIsLoading(false);enqueueSnackbar(\"\".concat((_context.t0===null||_context.t0===void 0?void 0:_context.t0.message)||\"Check your internet connection\"),{variant:\"error\"});case 13:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function(_x){return _ref.apply(this,arguments);};}());});};var updateBanner=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var timeNow,mRef;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsLoading(true);setFormValues({name:formValues.name?formValues.name:name,position:formValues.position?formValues.position:position});if(previewImage){_context2.next=19;break;}//No image is changed. So update all text\ntimeNow=new Date();_context2.prev=4;mRef=doc(db,\"team-members\",\"\"+id);_context2.next=8;return updateDoc(mRef,{name:formValues.name,position:formValues.position,biography:bio,updatedAt:timeNow});case 8:setOpen(false);setIsLoading(false);enqueueSnackbar(\"Team member updated successfully\",{variant:\"success\"});_context2.next=17;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](4);setIsLoading(false);enqueueSnackbar(\"\".concat(_context2.t0===null||_context2.t0===void 0?void 0:_context2.t0.message),{variant:\"error\"});case 17:_context2.next=20;break;case 19://Change on the featured image and all texts\nuploadNewImage();case 20:case\"end\":return _context2.stop();}}},_callee2,null,[[4,13]]);}));return function updateBanner(_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Backdrop,{style:{zIndex:1200},open:isUploading||isLoading,children:[isUploading?/*#__PURE__*/_jsx(CircularProgressWithLabel,{value:progress}):/*#__PURE__*/_jsx(\"div\",{}),isLoading?/*#__PURE__*/_jsx(CircularProgress,{size:90,thickness:3.0,style:{color:\"white\"}}):/*#__PURE__*/_jsx(\"div\",{})]}),/*#__PURE__*/_jsxs(ValidatorForm,{onSubmit:updateBanner,children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,padding:1,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:7,children:/*#__PURE__*/_jsx(TextValidator,{id:\"image\",size:\"small\",variant:\"outlined\",value:formValues.image,name:\"image\",type:\"file\",fullWidth:true,disabled:isLoading,accept:\".png, .jpg, .jpeg\",onChange:handleChange,helperText:\"Team member's photo\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:5,children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Avatar,{variant:\"rounded\",alt:\"Passport\",src:previewImage?previewImage:image,className:classes.image})})})]}),/*#__PURE__*/_jsx(TextValidator,{className:classes.mb,label:\"Name\",size:\"small\",variant:\"outlined\",value:formValues.name===\" \"?name:!formValues.name?\"\":formValues.name,onChange:handleChange,name:\"name\",fullWidth:true,required:true,validators:[\"required\"],errorMessages:[\"Name is required\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(TextValidator,{label:\"Position\",size:\"small\",variant:\"outlined\",value:formValues.position===\" \"?position:!formValues.position?\"\":formValues.position,onChange:handleChange,name:\"position\",fullWidth:true,validators:[\"required\"],errorMessages:[\"Member's position is required\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(EditableRichText,{value:bio,setValue:setBio,error:isError,setError:setIsError,setIsStartedFilling:setIsStartedFilling}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",disabled:isLoading||isUploading,fullWidth:true,children:\"Update\"})]})]});};export default UpdateTeamForm;","map":{"version":3,"sources":["/Users/macintosh/Developer/RSPHCMB-Admin/src/presentation/forms/about-rsphcmb/update_team.js"],"names":["React","ValidatorForm","TextValidator","Avatar","makeStyles","Button","db","ref","storage","doc","uploadBytesResumable","getDownloadURL","deleteObject","updateDoc","useSnackbar","Backdrop","Box","CircularProgress","Typography","Grid","RichText","EditableRichText","useStyles","theme","image","margin","width","height","mb","marginBottom","CircularProgressWithLabel","props","color","fontFamily","Math","round","value","UpdateTeamForm","classes","setOpen","id","name","position","biography","useState","formValues","setFormValues","file","setFile","isUploading","setIsUploading","isLoading","setIsLoading","progress","setProgress","bio","setBio","isError","setIsError","isStartedFilling","setIsStartedFilling","previewImage","setPreviewImage","enqueueSnackbar","handleChange","e","target","files","URL","createObjectURL","prevData","uploadNewImage","timeNow","Date","storageRef","getTime","uploadTask","on","snapshot","uprogress","bytesTransferred","totalBytes","error","message","variant","then","downloadURL","mRef","updatedAt","updateBanner","zIndex"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { ValidatorForm, TextValidator } from \"react-material-ui-form-validator\";\nimport Avatar from \"@mui/material/Avatar\";\nimport { makeStyles } from \"@mui/styles\";\nimport Button from \"@mui/material/Button\";\nimport {\n  db,\n  ref,\n  storage,\n  doc,\n  uploadBytesResumable,\n  getDownloadURL,\n  deleteObject,\n  updateDoc,\n} from \"../../../data/firebase\";\nimport { useSnackbar } from \"notistack\";\nimport Backdrop from \"@mui/material/Backdrop\";\nimport { Box } from \"@mui/system\";\nimport { CircularProgress } from \"@mui/material\";\nimport { Typography } from \"@mui/material\";\nimport { Grid } from \"@mui/material\";\nimport RichText from \"../../components/misc/richtext/\";\nimport EditableRichText from \"../../components/misc/richtext/editable\";\n\nconst useStyles = makeStyles((theme) => ({\n  image: {\n    margin: \"0px auto 15px auto\",\n    width: 128,\n    height: 100,\n  },\n  mb: {\n    marginBottom: 10,\n  },\n}));\n\nconst CircularProgressWithLabel = (props) => {\n  return (\n    <Box position=\"relative\" display=\"inline-flex\">\n      <CircularProgress\n        variant=\"determinate\"\n        {...props}\n        size={90}\n        thickness={3.0}\n        style={{ color: \"green\" }}\n      />\n      <Box\n        top={0}\n        left={0}\n        bottom={0}\n        right={0}\n        position=\"absolute\"\n        display=\"flex\"\n        alignItems=\"center\"\n        justifyContent=\"center\"\n      >\n        <Typography\n          variant=\"body1\"\n          component=\"div\"\n          style={{ color: \"white\", fontFamily: \"roboto\" }}\n        >{`${Math.round(props.value)}%`}</Typography>\n      </Box>\n    </Box>\n  );\n};\n\nconst UpdateTeamForm = (props) => {\n  const classes = useStyles();\n  let { setOpen, id, name, position, biography, image } = props;\n  const [formValues, setFormValues] = React.useState({\n    name: name,\n    image: \"\",\n    position: position,\n  });\n  const [file, setFile] = React.useState(null);\n  const [isUploading, setIsUploading] = React.useState(false);\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [progress, setProgress] = React.useState(0);\n  const [bio, setBio] = React.useState(biography);\n  const [isError, setIsError] = React.useState(false);\n  const [isStartedFilling, setIsStartedFilling] = React.useState(false);\n  const [previewImage, setPreviewImage] = React.useState(\"\");\n\n  const { enqueueSnackbar } = useSnackbar();\n\n  const handleChange = (e) => {\n    const { id, name, value } = e.target;\n\n    if (id === \"image\") {\n      setFile(e.target.files[0]);\n      setPreviewImage(URL.createObjectURL(e.target.files[0]));\n      setFormValues((prevData) => ({\n        ...prevData,\n        image: e.target.value,\n      }));\n    } else {\n      setFormValues((prevData) => ({ ...prevData, [name]: value }));\n    }\n  };\n\n  const uploadNewImage = () => {\n    setIsUploading(true);\n    const timeNow = new Date();\n    //First upload image to firebase storage then save to firestore\n    const storageRef = ref(storage, \"team-members/\" + timeNow.getTime());\n    const uploadTask = uploadBytesResumable(storageRef, file);\n\n    uploadTask.on(\n      \"state_changed\",\n      (snapshot) => {\n        const uprogress =\n          (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n        setProgress(uprogress);\n      },\n      (error) => {\n        setIsUploading(false);\n        // console.log(error);\n        enqueueSnackbar(`${error?.message}`, { variant: \"error\" });\n      },\n      () => {\n        setIsUploading(false);\n        setIsLoading(true);\n        getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n          const mRef = doc(db, \"team-members\", \"\" + id);\n          try {\n            await updateDoc(mRef, {\n              name: formValues.name,\n              position: formValues.position,\n              biography: bio,\n              updatedAt: timeNow,\n              image: downloadURL,\n            });\n            setOpen(false);\n            setIsLoading(false);\n            enqueueSnackbar(`Team member updated successfully`, {\n              variant: \"success\",\n            });\n          } catch (error) {\n            setIsLoading(false);\n            enqueueSnackbar(\n              `${error?.message || \"Check your internet connection\"}`,\n              {\n                variant: \"error\",\n              }\n            );\n          }\n        });\n      }\n    );\n  };\n\n  const updateBanner = async (e) => {\n    setIsLoading(true);\n    setFormValues({\n      name: formValues.name ? formValues.name : name,\n      position: formValues.position ? formValues.position : position,\n    });\n\n    if (!previewImage) {\n      //No image is changed. So update all text\n      const timeNow = new Date();\n      try {\n        const mRef = doc(db, \"team-members\", \"\" + id);\n        await updateDoc(mRef, {\n          name: formValues.name,\n          position: formValues.position,\n          biography: bio,\n          updatedAt: timeNow,\n        });\n        setOpen(false);\n        setIsLoading(false);\n        enqueueSnackbar(`Team member updated successfully`, {\n          variant: \"success\",\n        });\n      } catch (error) {\n        setIsLoading(false);\n        enqueueSnackbar(`${error?.message}`, {\n          variant: \"error\",\n        });\n      }\n    } else {\n      //Change on the featured image and all texts\n      uploadNewImage();\n    }\n  };\n\n  return (\n    <div>\n      <Backdrop style={{ zIndex: 1200 }} open={isUploading || isLoading}>\n        {isUploading ? <CircularProgressWithLabel value={progress} /> : <div />}\n        {isLoading ? (\n          <CircularProgress\n            size={90}\n            thickness={3.0}\n            style={{ color: \"white\" }}\n          />\n        ) : (\n          <div />\n        )}\n      </Backdrop>\n      <ValidatorForm onSubmit={updateBanner}>\n        <Grid container spacing={1} padding={1}>\n          <Grid item xs={12} sm={6} md={7}>\n            <TextValidator\n              id=\"image\"\n              size=\"small\"\n              variant=\"outlined\"\n              value={formValues.image}\n              name=\"image\"\n              type=\"file\"\n              fullWidth\n              disabled={isLoading}\n              accept=\".png, .jpg, .jpeg\"\n              onChange={handleChange}\n              helperText=\"Team member's photo\"\n            />\n          </Grid>\n\n          <Grid item xs={12} sm={6} md={5}>\n            <div>\n              <Avatar\n                variant=\"rounded\"\n                alt=\"Passport\"\n                src={previewImage ? previewImage : image}\n                className={classes.image}\n              />\n            </div>\n          </Grid>\n        </Grid>\n\n        <TextValidator\n          className={classes.mb}\n          label=\"Name\"\n          size=\"small\"\n          variant=\"outlined\"\n          value={\n            formValues.name === \" \"\n              ? name\n              : !formValues.name\n              ? \"\"\n              : formValues.name\n          }\n          onChange={handleChange}\n          name=\"name\"\n          fullWidth\n          required\n          validators={[\"required\"]}\n          errorMessages={[\"Name is required\"]}\n        />\n        <br />\n        <TextValidator\n          label=\"Position\"\n          size=\"small\"\n          variant=\"outlined\"\n          value={\n            formValues.position === \" \"\n              ? position\n              : !formValues.position\n              ? \"\"\n              : formValues.position\n          }\n          onChange={handleChange}\n          name=\"position\"\n          fullWidth\n          validators={[\"required\"]}\n          errorMessages={[\"Member's position is required\"]}\n        />\n        <br />\n        <EditableRichText\n          value={bio}\n          setValue={setBio}\n          error={isError}\n          setError={setIsError}\n          setIsStartedFilling={setIsStartedFilling}\n        />\n        <br />\n\n        <Button\n          type=\"submit\"\n          variant=\"contained\"\n          disabled={isLoading || isUploading}\n          fullWidth\n        >\n          Update\n        </Button>\n      </ValidatorForm>\n    </div>\n  );\n};\n\nexport default UpdateTeamForm;\n"]},"metadata":{},"sourceType":"module"}